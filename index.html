<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Lot Size Calculator – GBP (Aurora Blue + Meteor Shower, MT5‑ready)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
/* ===== THEME ===== */
:root{
  --bg-navy:#0b1320;          /* slightly illuminated navy */
  --bg-navy-2:#0d1a2b;
  --glow-1:#0d5bd7;
  --glow-2:#1aa3ff;
  --glass:#11192aee;
  --text:#e9eef7;
  --muted:#a7b4c9;
  --accent:#7ab8ff;
  --danger:#ff6b6b;
  --border:rgba(122,184,255,.22);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
  color:var(--text);
  background: radial-gradient(1200px 900px at 65% 35%, rgba(0,119,255,.22), transparent 55%),
              radial-gradient(900px 700px at 30% 70%, rgba(0,180,255,.18), transparent 60%),
              linear-gradient(180deg, var(--bg-navy), var(--bg-navy-2));
  overflow-x:hidden;
}

/* animated soft glow (subtle) */
body::before, body::after{
  content:"";
  position:fixed; inset:-10%;
  background:
    radial-gradient(600px 500px at 70% 30%, rgba(0,120,255,.14), transparent 60%),
    radial-gradient(500px 400px at 20% 80%, rgba(0,170,255,.10), transparent 65%);
  filter: blur(30px);
  animation: drift 24s linear infinite;
  pointer-events:none;
  z-index:0;
  opacity:.9;
}
body::after{ animation-duration: 36s; animation-direction: reverse; opacity:.7}
@keyframes drift{
  0%{ transform: translate3d(-1%, -1%, 0) scale(1.02)}
  50%{ transform: translate3d(1%, 1%, 0) scale(1.04)}
  100%{ transform: translate3d(-1%, -1%, 0) scale(1.02)}
}

/* CANVAS sits behind all content */
#sky{
  position:fixed; inset:0; width:100%; height:100%;
  z-index:0;
  pointer-events:none;
}

/* CONTENT WRAPPER */
.wrap{max-width:960px;margin:48px auto;padding:16px;position:relative;z-index:1}
.title{font-size:28px;font-weight:800;margin-bottom:18px;letter-spacing:.2px}
.card{
  background: var(--glass);
  border:1px solid var(--border);
  border-radius:16px;
  padding:18px;
  backdrop-filter: blur(8px);
  box-shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.04);
}

/* GRID */
.grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:14px}
@media(max-width:760px){.grid{grid-template-columns:1fr}}

/* FIELDS */
.field{display:flex;flex-direction:column;gap:8px}
label{font-size:13px;color:var(--muted)}
input,select{
  width:100%; padding:12px 14px;
  border-radius:12px; outline:none;
  border:1px solid var(--border);
  color:var(--text);
  background: rgba(10,18,35,.8);
  transition: border-color .25s, box-shadow .25s, background-color .25s;
  position:relative; overflow:hidden;
}

/* sweeping glow on focus */
input:focus,select:focus{
  border-color: var(--accent);
  box-shadow: 0 0 0 4px rgba(122,184,255,.15), 0 0 24px rgba(30,140,255,.25);
  background-image:
    linear-gradient(120deg, transparent 0%, rgba(122,184,255,.06) 15%, rgba(122,184,255,.22) 30%,
                            rgba(122,184,255,.06) 45%, transparent 60%);
  background-size: 200% 100%;
  animation: sweep 1.6s ease-out infinite;
}
@keyframes sweep{
  0%{ background-position: -80% 0 }
  100%{ background-position: 180% 0 }
}

.btn{
  display:inline-flex;justify-content:center;align-items:center;
  gap:8px;
  padding:12px 16px;border-radius:12px;
  border:1px solid var(--border);
  color:white; font-weight:700; cursor:pointer;
  background: linear-gradient(180deg, #3c79ff, #2c63dd);
  box-shadow: 0 6px 16px rgba(0,60,160,.35);
  transition: filter .2s, transform .06s;
  margin-top:6px;
}
.btn:hover{ filter:brightness(1.07)}
.btn:active{ transform: translateY(1px)}

.warn{color:var(--danger);font-size:12px;margin-top:8px}
.result{
  margin-top:16px; padding:14px;
  background: rgba(12,18,34,.8);
  border:1px dashed rgba(122,184,255,.35);
  border-radius:12px;
}
.help{font-size:12px;color:var(--muted);margin-top:4px}
.mono{font-family:ui-monospace,Menlo,Consolas,monospace}
.kv{display:grid;grid-template-columns:220px 1fr;gap:6px 14px}
@media(max-width:760px){.kv{grid-template-columns:1fr}}
</style>
</head>
<body>
<canvas id="sky"></canvas>

<div class="wrap">
  <div class="title">Lot Size Calculator (GBP Account – Aurora Blue + Meteor Shower)</div>
  <div class="card">
    <div class="grid">
      <div class="field">
        <label for="balance">Account Balance (GBP)</label>
        <input id="balance" type="number" min="0" step="0.01" placeholder="e.g. 10000">
      </div>
      <div class="field">
        <label for="riskPct">Risk Percentage (%)</label>
        <input id="riskPct" type="number" min="0" step="0.01" placeholder="e.g. 1">
      </div>
      <div class="field">
        <label for="leverage">Leverage (e.g. 30 for 1:30)</label>
        <input id="leverage" type="number" min="1" step="1" placeholder="e.g. 30">
      </div>
      <div class="field">
        <label for="slPips">Stop Loss (pips)</label>
        <input id="slPips" type="number" min="0" step="0.1" placeholder="e.g. 25">
        <div class="help">You can also enter Entry + SL price instead.</div>
      </div>
      <div class="field">
        <label for="entry">Entry Price (optional)</label>
        <input id="entry" type="number" step="0.00001" placeholder="e.g. 1.2500">
      </div>
      <div class="field">
        <label for="slPrice">Stop Loss Price (optional)</label>
        <input id="slPrice" type="number" step="0.00001" placeholder="e.g. 1.2475">
        <div class="help">If both are entered, Stop Loss (pips) auto‑calculates.</div>
      </div>
      <div class="field">
        <label for="pair">Currency Pair</label>
        <select id="pair">
          <optgroup label="All 28 Major & Minor Pairs">
            <option>AUDCAD</option><option>AUDCHF</option><option>AUDJPY</option><option>AUDNZD</option><option>AUDUSD</option>
            <option>CADCHF</option><option>CADJPY</option><option>CHFJPY</option>
            <option>EURAUD</option><option>EURCAD</option><option>EURCHF</option><option>EURGBP</option><option>EURJPY</option><option>EURNZD</option><option>EURUSD</option>
            <option>GBPAUD</option><option>GBPCAD</option><option>GBPCHF</option><option>GBPJPY</option><option>GBPNZD</option><option>GBPUSD</option>
            <option>NZDCAD</option><option>NZDCHF</option><option>NZDJPY</option><option>NZDUSD</option>
            <option>USDCAD</option><option>USDCHF</option><option>USDJPY</option>
          </optgroup>
        </select>
      </div>
      <div class="field" id="priceWrap" style="display:none">
        <label for="price">Current Market Price (for JPY pairs)</label>
        <input id="price" type="number" step="0.00001" placeholder="e.g. 193.50">
        <div class="help">Needed only for JPY‑based pairs.</div>
      </div>
    </div>

    <button class="btn" id="calcBtn">Calculate Lot Size →</button>
    <div id="msg" class="warn" style="display:none"></div>

    <div class="result">
      <div class="kv">
        <div><strong>Risk Amount:</strong></div><div><span id="riskAmt" class="mono">—</span></div>
        <div><strong>Pip Value (per 1.00 lot):</strong></div><div><span id="pipVal" class="mono">—</span></div>
        <div><strong>Recommended Lot Size:</strong></div><div><span id="lotOut" class="mono">—</span></div>
        <div><strong>Trade Value (Notional):</strong></div><div><span id="tradeValue" class="mono">—</span></div>
        <div><strong>Estimated Margin Required:</strong></div><div><span id="marginReq" class="mono">—</span></div>
        <div><strong>Max Lot by Margin:</strong></div><div><span id="maxLotByMargin" class="mono">—</span></div>
        <div><strong>Lot to Enter on MT5:</strong></div><div><span id="lotForMT5" class="mono">—</span></div>
      </div>
    </div>
    <div class="help">
      Pip value is computed in the pair's <em>quote</em> currency and converted to GBP. Enter the pair price in <strong>Entry Price</strong> for best accuracy. For JPY pairs, also enter <strong>Current Market Price</strong>.
    </div>
  </div>
</div>

<script>
/* ====== CALCULATOR LOGIC (same accuracy as previous build) ====== */
const pairEl=document.getElementById('pair'),priceWrap=document.getElementById('priceWrap');
function needsPrice(p){return p.endsWith('JPY');}
pairEl.addEventListener('change',()=>{priceWrap.style.display=needsPrice(pairEl.value)?'':'none';});

function formatGBP(n){return isFinite(n)?'£'+n.toLocaleString(undefined,{maximumFractionDigits:2}):'—';}
function formatNum(n,d=3){return isFinite(n)?n.toLocaleString(undefined,{maximumFractionDigits:d}):'—';}

function getPairPrice(){
  const e=parseFloat(document.getElementById('entry').value);
  const p=parseFloat(document.getElementById('price').value);
  if(e>0) return e;
  if(p>0) return p;
  return NaN;
}

function pipValueGBPPerLot(pair){
  const b=pair.slice(0,3), q=pair.slice(3,6);
  const gbpUsdRef=1.25;
  const gbpPerUSD=1/gbpUsdRef;
  const px=getPairPrice();

  function quoteToGBP(){
    if(q==='GBP') return 1;
    if(q==='USD') return gbpPerUSD;
    if(q==='JPY'){
      const usdJpy=(b==='USD'&&q==='JPY')?px:NaN;
      if(isFinite(usdJpy)) return gbpPerUSD*(1/usdJpy);
      return NaN;
    }
    if(b==='USD'){
      if(!isFinite(px)) return NaN;
      return gbpPerUSD*(1/px);
    }
    return gbpPerUSD; // fallback
  }

  const pipSizeUnits=q==='JPY'?1000:10;
  const gbpPerQuote=quoteToGBP();
  if(!isFinite(gbpPerQuote)) return NaN;
  return pipSizeUnits*gbpPerQuote;
}

function maxLotByMargin(balanceGBP, leverage, pair){
  const b=pair.slice(0,3), q=pair.slice(3,6);
  const gbpUsdRef=1.25, gbpPerUSD=1/gbpUsdRef;
  const px=getPairPrice();
  let gbpPerBase;
  if(b==='GBP'){ gbpPerBase=1; }
  else if(b==='USD'){ gbpPerBase=gbpPerUSD; }
  else if(q==='USD' && isFinite(px)){ gbpPerBase=gbpPerUSD*px; }
  else { gbpPerBase=gbpPerUSD; }
  const marginPerLotGBP=(100000/leverage)*gbpPerBase;
  return balanceGBP/marginPerLotGBP;
}

document.getElementById('calcBtn').addEventListener('click',()=>{
  const balance=parseFloat(document.getElementById('balance').value);
  const riskPct=parseFloat(document.getElementById('riskPct').value);
  const leverage=parseFloat(document.getElementById('leverage').value);
  const slPipsEl=document.getElementById('slPips');
  let slPips=parseFloat(slPipsEl.value);
  const entry=parseFloat(document.getElementById('entry').value);
  const slPrice=parseFloat(document.getElementById('slPrice').value);
  const pair=pairEl.value;
  const msg=document.getElementById('msg');

  if(entry && slPrice && !slPips){
    const diff=Math.abs(entry-slPrice);
    const pipSize=pair.endsWith('JPY')?0.01:0.0001;
    slPips=diff/pipSize;
    slPipsEl.value=slPips.toFixed(1);
  }

  if(!(balance>0 && riskPct>0 && slPips>0 && leverage>0)){
    msg.textContent='Please enter Balance, Risk%, Stop Loss, and Leverage.';
    msg.style.display='';
    return;
  }

  const riskAmt=balance*(riskPct/100);
  const pv=pipValueGBPPerLot(pair);
  if(!isFinite(pv)){
    msg.textContent='Please enter the pair price in Entry Price so we can convert pip value accurately for this pair.';
    msg.style.display='';
    return;
  }

  const recLot=riskAmt/(slPips*pv);
  const marginLotsMax=maxLotByMargin(balance, leverage, pair);
  const lotToPlace=Math.max(0, Math.min(recLot, marginLotsMax));

  document.getElementById('riskAmt').textContent=formatGBP(riskAmt);
  document.getElementById('pipVal').textContent=formatGBP(pv)+' / pip / 1.00 lot';
  document.getElementById('lotOut').textContent=formatNum(recLot)+' lots';
  document.getElementById('tradeValue').textContent=formatNum(recLot*100000,0)+' (base units)';
  const gbpUsdRef=1.25, gbpPerUSD=1/gbpUsdRef;
  const marginPerLotGBP=(100000/leverage)*gbpPerUSD;
  const marginGBP=recLot*marginPerLotGBP;
  document.getElementById('marginReq').textContent=formatGBP(marginGBP);
  document.getElementById('maxLotByMargin').textContent=formatNum(marginLotsMax,3)+' lots';
  document.getElementById('lotForMT5').textContent=formatNum(lotToPlace,3)+' lots';
  msg.style.display='none';
});

/* ====== AURORA SKY: twinkles + meteor shower (2–3 at once) ====== */
(function(){
  const c=document.getElementById('sky');
  const ctx=c.getContext('2d');
  let w,h,stars=[],meteors=[];
  const DPR = Math.max(1, window.devicePixelRatio || 1);

  function resize(){
    w = c.width  = Math.floor(window.innerWidth * DPR);
    h = c.height = Math.floor(window.innerHeight * DPR);
    ctx.setTransform(1,0,0,1,0,0);
    ctx.scale(DPR, DPR); // draw in CSS pixels while keeping sharp
    spawnStars();
  }
  window.addEventListener('resize', resize, {passive:true});
  resize();

  function spawnStars(){
    const count = Math.floor((window.innerWidth*window.innerHeight)/9000); // density
    stars = [];
    for(let i=0;i<count;i++){
      stars.push({
        x: Math.random()*window.innerWidth,
        y: Math.random()*window.innerHeight,
        r: Math.random()*1.2 + 0.2,
        a: Math.random()*0.6 + 0.2,
        tw: Math.random()*0.02 + 0.005
      });
    }
  }

  function spawnMeteor(){
    // Create 2–3 at once occasionally
    const burst = Math.random()<0.18 ? (2 + Math.floor(Math.random()*2)) : 1;
    for(let i=0;i<burst;i++){
      const fromTop = Math.random() < 0.5;
      const startX = Math.random()*window.innerWidth*0.8 + window.innerWidth*0.1;
      const startY = fromTop ? -20 : Math.random()*window.innerHeight*0.3 + 20;
      const speed = 600 + Math.random()*600; // px/sec
      const angle = (-35 - Math.random()*20) * (Math.PI/180); // slight diagonal
      meteors.push({
        x:startX, y:startY, vx: Math.cos(angle)*speed/60, vy: Math.sin(angle)*speed/60,
        life: 60 + Math.random()*40, // frames
        len: 180 + Math.random()*140, // trail length
        w: 1 + Math.random()*1.5,
        alpha: 1
      });
    }
  }

  let frame=0;
  function tick(){
    frame++;
    ctx.clearRect(0,0,window.innerWidth,window.innerHeight);

    // Stars
    ctx.save();
    ctx.fillStyle = '#ffffff';
    for(const s of stars){
      s.a += s.tw;
      const o = 0.35 + 0.35*Math.sin(s.a);
      ctx.globalAlpha = o;
      ctx.beginPath();
      ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
      ctx.fill();
    }
    ctx.restore();

    // Spawn meteors periodically
    if(frame % 90 === 0 || (meteors.length<2 && frame%40===0)){
      spawnMeteor();
    }

    // Meteors
    for(let i=meteors.length-1;i>=0;i--){
      const m = meteors[i];
      m.x += m.vx;
      m.y += m.vy;
      m.life -= 1;
      m.alpha = Math.max(0, m.life/80);

      // draw trail
      const trailX = m.x - m.vx * (m.len/ (Math.hypot(m.vx,m.vy)));
      const trailY = m.y - m.vy * (m.len/ (Math.hypot(m.vx,m.vy)));

      const grd = ctx.createLinearGradient(m.x, m.y, trailX, trailY);
      grd.addColorStop(0, "rgba(255,255,255,1)");
      grd.addColorStop(1, "rgba(255,255,255,0)");

      ctx.strokeStyle = grd;
      ctx.lineWidth = m.w;
      ctx.globalAlpha = m.alpha;
      ctx.beginPath();
      ctx.moveTo(m.x, m.y);
      ctx.lineTo(trailX, trailY);
      ctx.stroke();
      ctx.globalAlpha = 1;

      if(m.life<=0 || m.x < -200 || m.y > window.innerHeight+200) meteors.splice(i,1);
    }

    requestAnimationFrame(tick);
  }
  tick();
})();
</script>
</body>
</html>